var g=Object.defineProperty;var m=(e,o,t)=>o in e?g(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var c=(e,o,t)=>m(e,typeof o!="symbol"?o+"":o,t);import{i as p,j as i}from"./index-C2aYM6LG.js";import{H as d,e as _,c as h}from"./http-CD2YnwdB.js";const r=class r extends d{constructor(){if(super(),r._instance)return r._instance;r._instance=this}static get instance(){return this._instance??(this._instance=new this)}login(o){return super.post("usuario/login",o,!1)}obtener(){return super.get("usuario",null,!0)}registrar(o){return super.post("usuario/registro",o,!1)}};c(r,"_instance");let s=r;const I=p("usuario_store",{state:()=>({usuarios:[],logueado:!1,usuarioActual:null}),getters:{esUsuarioLogueado:e=>e.logueado===!0,obtenerUsuarioActual:e=>e.usuarioActual},actions:{login(e){return s.instance.login(e).then(o=>{var u,a,l,n;console.log("üîç Respuesta completa del login:",o);const t={id:o.id,usuario:e.usuario,token:o.token,nombre:(u=o.usuario)==null?void 0:u.nombre,apellidos:(a=o.usuario)==null?void 0:a.apellidos,telefono:(l=o.usuario)==null?void 0:l.telefono,tipo_usuario:(n=o.usuario)==null?void 0:n.tipo_usuario};return console.log("üë§ Datos del usuario procesados:",t),localStorage.setItem("token",t.token),localStorage.setItem("usuario_id",t.id.toString()),localStorage.setItem("tipo_usuario",t.tipo_usuario),localStorage.setItem("nombre_usuario",t.nombre||""),console.log("üíæ Guardado en localStorage:"),console.log("  - token:",localStorage.getItem("token")?"OK":"ERROR"),console.log("  - usuario_id:",localStorage.getItem("usuario_id")),console.log("  - tipo_usuario:",localStorage.getItem("tipo_usuario")),h(t.token,t),this.usuarioActual=t,this.logueado=!0,console.log("‚úÖ Usuario logueado exitosamente"),t.tipo_usuario==="empleado"?(console.log("üöÄ Redirigiendo a bienvenida-empleado"),i.push("/bienvenida-empleado")):(console.log("üöÄ Redirigiendo a bienvenida"),i.push("/bienvenida")),Promise.resolve(o)}).catch(o=>(console.error("‚ùå Error en login:",o),this.logueado=!1,this.usuarioActual=null,Promise.reject(o)))},registrarUsuario(e){return s.instance.registrar(e)},logout(){_(),localStorage.removeItem("token"),localStorage.removeItem("usuario_id"),localStorage.removeItem("tipo_usuario"),localStorage.removeItem("nombre_usuario"),this.logueado=!1,this.usuarioActual=null,console.log("üö™ Usuario deslogueado"),i.push("/login")}},persist:!0});export{I as u};
