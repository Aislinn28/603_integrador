import{_ as ie,r as q,l as s,m as se,p as ne,c as h,w as r,a as i,u as ue,o as n,b as t,e as u,q as de,d as v,h as j,f as x,g as f,t as m,F as ve,s as me}from"./index-C2aYM6LG.js";import{u as ce}from"./vehiculos-2rN432G1.js";import{u as pe}from"./reservas-FbF4vKKn.js";import"./http-CD2YnwdB.js";import"./ReservasService-CEgvyNxi.js";const _e={key:0},fe={key:0},be={class:"text-caption"},Ve={key:1,class:"mt-2"},he={class:"text-caption"},xe={class:"text-h6 primary--text"},ge={__name:"RealizarReserva",setup(ye){const B=ue(),k=ce(),A=pe(),D=q(null),c=q({show:!1,message:"",color:"success"}),e=q({fecha:"",hora:"",vehiculo_id:null,tipo_servicio:"",autolavado:{lavado_exterior:!1,lavado_interior:!1,encerado:!1,aspirado:!1,limpieza_llantas:!1,aromatizante:!1},estacionamiento:{tipo_tarifa:"",horas_estimadas:1,hora_salida:""}}),F=[{title:"Autolavado",value:"autolavado"},{title:"Estacionamiento",value:"estacionamiento"},{title:"Ambos Servicios",value:"ambos"}],p={required:o=>!!o||"Campo requerido",minHoras:o=>o>=1&&o<=24||"Entre 1 y 24 horas"},N=[o=>!!o||"Debe seleccionar un tipo de tarifa"],O=s(()=>k.obtenerVehiculos.map(o=>({text:`${o.placa} - ${o.color} ${o.modelo}`,value:o.id}))),g=s(()=>e.value.tipo_servicio==="autolavado"||e.value.tipo_servicio==="ambos"),b=s(()=>e.value.tipo_servicio==="estacionamiento"||e.value.tipo_servicio==="ambos"),P=s(()=>g.value||b.value),C=s(()=>{const o=e.value.autolavado;return o.lavado_exterior||o.lavado_interior||o.encerado||o.aspirado||o.limpieza_llantas||o.aromatizante}),L=s(()=>{const o=[],a={lavado_exterior:{nombre:"Lavado Exterior",precio:50},lavado_interior:{nombre:"Lavado Interior",precio:40},encerado:{nombre:"Encerado",precio:80},aspirado:{nombre:"Aspirado",precio:30},limpieza_llantas:{nombre:"Limpieza de Llantas",precio:25},aromatizante:{nombre:"Aromatizante",precio:15}};return Object.keys(e.value.autolavado).forEach(d=>{e.value.autolavado[d]&&a[d]&&o.push(a[d])}),o}),T=s(()=>L.value.reduce((o,a)=>o+a.precio,0)),H=s(()=>b.value?e.value.estacionamiento.tipo_tarifa==="tiempo_completo"?100:e.value.estacionamiento.tipo_tarifa==="por_hora"?(e.value.estacionamiento.horas_estimadas||1)*15:0:0),G=s(()=>T.value+H.value),J=s(()=>!(!(e.value.fecha&&e.value.hora&&e.value.vehiculo_id&&e.value.tipo_servicio)||(e.value.tipo_servicio==="autolavado"||e.value.tipo_servicio==="ambos")&&!C.value||(e.value.tipo_servicio==="estacionamiento"||e.value.tipo_servicio==="ambos")&&!e.value.estacionamiento.tipo_tarifa)),K=()=>{e.value.tipo_servicio!=="autolavado"&&e.value.tipo_servicio!=="ambos"&&Object.keys(e.value.autolavado).forEach(o=>{e.value.autolavado[o]=!1}),e.value.tipo_servicio!=="estacionamiento"&&e.value.tipo_servicio!=="ambos"&&(e.value.estacionamiento.tipo_tarifa="",e.value.estacionamiento.horas_estimadas=1,e.value.estacionamiento.hora_salida="")},z=(o,a="success")=>{c.value={show:!0,message:o,color:a}},Q=async()=>{try{const o={vehiculo_id:e.value.vehiculo_id,fecha:e.value.fecha,hora:e.value.hora,tipo_servicio:e.value.tipo_servicio};g.value&&(o.autolavado={...e.value.autolavado}),b.value&&(o.estacionamiento={...e.value.estacionamiento}),await A.crearReserva(o),z("Reserva creada exitosamente"),W(),setTimeout(()=>{B.push("/mis-reservas")},2e3)}catch(o){console.error("Error al crear reserva:",o),z("Error al crear la reserva. Intente nuevamente.","error")}},W=()=>{e.value={fecha:"",hora:"",vehiculo_id:null,tipo_servicio:"",autolavado:{lavado_exterior:!1,lavado_interior:!1,encerado:!1,aspirado:!1,limpieza_llantas:!1,aromatizante:!1},estacionamiento:{tipo_tarifa:"",horas_estimadas:1,hora_salida:""}}};return se(()=>e.value.estacionamiento.horas_estimadas,o=>{if(o&&e.value.hora){const a=new Date(`2000-01-01T${e.value.hora}:00`);a.setHours(a.getHours()+parseInt(o));const d=a.getHours().toString().padStart(2,"0"),E=a.getMinutes().toString().padStart(2,"0");e.value.estacionamiento.hora_salida=`${d}:${E}`}}),ne(async()=>{try{await k.cargarVehiculos()}catch(o){console.error("Error al cargar vehículos:",o),z("Error al cargar los vehículos","error")}}),(o,a)=>{const d=i("v-toolbar-title"),E=i("v-toolbar"),y=i("v-text-field"),V=i("v-col"),R=i("v-row"),I=i("v-select"),w=i("v-card-title"),_=i("v-checkbox"),X=i("v-alert"),S=i("v-card-text"),$=i("v-card"),M=i("v-radio"),Y=i("v-radio-group"),Z=i("v-divider"),ee=i("v-spacer"),U=i("v-btn"),ae=i("v-card-actions"),oe=i("v-form"),te=i("v-snackbar"),le=i("v-container");return n(),h(le,{class:"fill-height",fluid:""},{default:r(()=>[t(R,{justify:"center"},{default:r(()=>[t(V,{cols:"12",md:"8",lg:"6"},{default:r(()=>[t($,{elevation:"12",class:"pa-6"},{default:r(()=>[t(E,{flat:"",color:"primary",dark:""},{default:r(()=>[t(d,null,{default:r(()=>a[16]||(a[16]=[u("Realizar Reserva")])),_:1})]),_:1}),t(oe,{onSubmit:de(Q,["prevent"]),ref_key:"formReserva",ref:D},{default:r(()=>[t(S,null,{default:r(()=>[t(R,null,{default:r(()=>[t(V,{cols:"12",sm:"6"},{default:r(()=>[t(y,{modelValue:e.value.fecha,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.fecha=l),label:"Fecha",type:"date",rules:[p.required],required:""},null,8,["modelValue","rules"])]),_:1}),t(V,{cols:"12",sm:"6"},{default:r(()=>[t(y,{modelValue:e.value.hora,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.hora=l),label:"Hora",type:"time",rules:[p.required],required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(I,{modelValue:e.value.vehiculo_id,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.vehiculo_id=l),items:O.value,"item-title":"text","item-value":"value",label:"Seleccionar Vehículo",rules:[p.required],required:"",loading:j(k).estaLoading},null,8,["modelValue","items","rules","loading"]),t(I,{modelValue:e.value.tipo_servicio,"onUpdate:modelValue":[a[3]||(a[3]=l=>e.value.tipo_servicio=l),K],items:F,label:"Tipo de Servicio",rules:[p.required],required:""},null,8,["modelValue","rules"]),g.value?(n(),h($,{key:0,class:"mt-4",outlined:""},{default:r(()=>[t(w,{class:"text-h6 primary--text"},{default:r(()=>a[17]||(a[17]=[u(" Servicios de Autolavado ")])),_:1}),t(S,null,{default:r(()=>[t(R,null,{default:r(()=>[t(V,{cols:"12",sm:"6"},{default:r(()=>[t(_,{modelValue:e.value.autolavado.lavado_exterior,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.autolavado.lavado_exterior=l),label:"Lavado Exterior ($50)"},null,8,["modelValue"]),t(_,{modelValue:e.value.autolavado.lavado_interior,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.autolavado.lavado_interior=l),label:"Lavado Interior ($40)"},null,8,["modelValue"]),t(_,{modelValue:e.value.autolavado.encerado,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.autolavado.encerado=l),label:"Encerado ($80)"},null,8,["modelValue"])]),_:1}),t(V,{cols:"12",sm:"6"},{default:r(()=>[t(_,{modelValue:e.value.autolavado.aspirado,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.autolavado.aspirado=l),label:"Aspirado ($30)"},null,8,["modelValue"]),t(_,{modelValue:e.value.autolavado.limpieza_llantas,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.autolavado.limpieza_llantas=l),label:"Limpieza de Llantas ($25)"},null,8,["modelValue"]),t(_,{modelValue:e.value.autolavado.aromatizante,"onUpdate:modelValue":a[9]||(a[9]=l=>e.value.autolavado.aromatizante=l),label:"Aromatizante ($15)"},null,8,["modelValue"])]),_:1})]),_:1}),e.value.tipo_servicio==="autolavado"&&!C.value?(n(),h(X,{key:0,type:"warning",dense:""},{default:r(()=>a[18]||(a[18]=[u(" Debe seleccionar al menos un servicio de autolavado ")])),_:1})):v("",!0)]),_:1})]),_:1})):v("",!0),b.value?(n(),h($,{key:1,class:"mt-4",outlined:""},{default:r(()=>[t(w,{class:"text-h6 primary--text"},{default:r(()=>a[19]||(a[19]=[u(" Servicios de Estacionamiento ")])),_:1}),t(S,null,{default:r(()=>[t(Y,{modelValue:e.value.estacionamiento.tipo_tarifa,"onUpdate:modelValue":a[10]||(a[10]=l=>e.value.estacionamiento.tipo_tarifa=l),rules:N},{default:r(()=>[t(M,{label:"Por Hora ($15/hora)",value:"por_hora"}),t(M,{label:"Tiempo Completo ($100)",value:"tiempo_completo"})]),_:1},8,["modelValue"]),e.value.estacionamiento.tipo_tarifa==="por_hora"?(n(),x("div",_e,[t(y,{modelValue:e.value.estacionamiento.horas_estimadas,"onUpdate:modelValue":a[11]||(a[11]=l=>e.value.estacionamiento.horas_estimadas=l),modelModifiers:{number:!0},label:"Horas Estimadas",type:"number",min:"1",max:"24",rules:[p.required,p.minHoras]},null,8,["modelValue","rules"]),t(y,{modelValue:e.value.estacionamiento.hora_salida,"onUpdate:modelValue":a[12]||(a[12]=l=>e.value.estacionamiento.hora_salida=l),label:"Hora de Salida Estimada",type:"time"},null,8,["modelValue"])])):v("",!0)]),_:1})]),_:1})):v("",!0),P.value?(n(),h($,{key:2,class:"mt-4",color:"grey-lighten-4"},{default:r(()=>[t(w,{class:"text-h6"},{default:r(()=>a[20]||(a[20]=[u("Resumen de Costos")])),_:1}),t(S,null,{default:r(()=>[g.value?(n(),x("div",fe,[f("strong",null,"Autolavado: $"+m(T.value),1),f("div",be,[(n(!0),x(ve,null,me(L.value,(l,re)=>(n(),x("div",{key:re},m(l.nombre)+": $"+m(l.precio),1))),128))])])):v("",!0),b.value?(n(),x("div",Ve,[f("strong",null,"Estacionamiento: $"+m(H.value),1),f("div",he,m(e.value.estacionamiento.tipo_tarifa==="tiempo_completo"?"Tiempo completo":`${e.value.estacionamiento.horas_estimadas||0} hora(s)`),1)])):v("",!0),t(Z,{class:"my-2"}),f("div",xe,[f("strong",null,"Total: $"+m(G.value),1)])]),_:1})]),_:1})):v("",!0)]),_:1}),t(ae,null,{default:r(()=>[t(ee),t(U,{color:"grey",variant:"text",onClick:a[13]||(a[13]=l=>o.$router.push("/bienvenida"))},{default:r(()=>a[21]||(a[21]=[u(" Cancelar ")])),_:1}),t(U,{color:"primary",type:"submit",loading:j(A).estaLoading,disabled:!J.value},{default:r(()=>a[22]||(a[22]=[u(" Crear Reserva ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1}),t(te,{modelValue:c.value.show,"onUpdate:modelValue":a[15]||(a[15]=l=>c.value.show=l),color:c.value.color,timeout:3e3},{actions:r(()=>[t(U,{variant:"text",onClick:a[14]||(a[14]=l=>c.value.show=!1)},{default:r(()=>a[23]||(a[23]=[u(" Cerrar ")])),_:1})]),default:r(()=>[u(m(c.value.message)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},Re=ie(ge,[["__scopeId","data-v-c0781241"]]);export{Re as default};
